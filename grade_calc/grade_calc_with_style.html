<!DOCTYPE html>
<html>
<head>
    <title>Grade Calculator</title>
    <meta name="author" content="Kelvin Abrokwa-Johnson">
    <!--link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap-theme.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    
    <style>
        body {padding: 1cm 1cm 1cm 1cm;}
        button,
        input,
        optgroup,
        select,
        textarea {
          margin: 0;
          font: inherit;
          color: inherit;
        }
        button {
          overflow: visible;
        }
        button,
        select {
          text-transform: none;
        }
        button,
        html input[type="button"],
        input[type="reset"],
        input[type="submit"] {
          -webkit-appearance: button;
          cursor: pointer;
        }
        button[disabled],
        html input[disabled] {
          cursor: default;
        }
        button::-moz-focus-inner,
        input::-moz-focus-inner {
          padding: 0;
          border: 0;
        }
        input {
          line-height: normal;
        }
        input[type="checkbox"],
        input[type="radio"] {
          -webkit-box-sizing: border-box;
             -moz-box-sizing: border-box;
                  box-sizing: border-box;
          padding: 0;
        }
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
          height: auto;
        }
        input[type="search"] {
          -webkit-box-sizing: content-box;
             -moz-box-sizing: content-box;
                  box-sizing: content-box;
          -webkit-appearance: textfield;
        }
        input[type="search"]::-webkit-search-cancel-button,
        input[type="search"]::-webkit-search-decoration {
          -webkit-appearance: none;
        }
        /* Well */
        .well {
          min-height: 20px;
          padding: 19px;
          margin-bottom: 20px;
          background-color: #f5f5f5;
          border: 1px solid #e3e3e3;
          border-radius: 4px;
          -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, .05);
                  box-shadow: inset 0 1px 1px rgba(0, 0, 0, .05);
        }
        .well blockquote {
          border-color: #ddd;
          border-color: rgba(0, 0, 0, .15);
        }
        .well-lg {
          padding: 24px;
          border-radius: 6px;
        }
        .well-sm {
          padding: 9px;
          border-radius: 3px;
        }
    </style>
</head>
<body>
    <h2>C's Get Degrees: A Grade Calculator</h2>
    <p>Finals are almost here and there is one question on everyone's mind: What do I need on this final (or any other upcoming assignment) to get an A in a class? If you're like us, you probably spend more time calculating the grade you need on that big final than actually studying. Finally, here is the app to help you work that out!</p><br>
    <p>Read the instructions and use this app to find that magic number!</p>
    <br>

    <div>
        <h4 class="modal-title">Disclaimer</h4>
        <p>The Crim Bell Curve and the Flat Hat are not responsible for any final grade outcomes based on these calculations. The formulas used here work normally but professors are free to structure grading systems as they choose. We are all peasants, just peasants.</p>
    </div>
      
    
    <br/>
    <h4><u>Instructions</u></h4>
    <ul>
        <li>Input category names in the first column (midterms, final, projects, etc.)</li>
        <li>Input category weights as percentages in the second column</li>
        <li>Input all grades received in the third column separated by commas (if there have been no grades so far, leave blank)</li>
        <li>Select the category in which your upcoming assignment will be on the left of the form</li>
        <li>For each form used, click the "Update Category" button to the right</li>
    </ul>
    <br/>

    <h4><u>Target Grade</u></h4>
    <p>Enter your target grade as a percentage</p>
    <form id="form" onsubmit="return false;">
        <input type="text" id="target_grade" placeholder="Target Grade" onkeypress="return inputLimiter(event, 'Numbers')"/>
    </form>
    <br><br>
    <h4><u>Input Current Grades</u></h4><br>
    <form id="form" onsubmit="return false;">
        <input type="radio" name="choice" checked/>&nbsp&nbsp&nbsp
        <input type="text" id="cat1_name" placeholder="Category (eg. quizzes)"/>
        <input type="text" id="cat1_weight" placeholder="Weight (eg. 30)" onkeypress="return inputLimiter(event, 'Numbers')"/>
        <input type="text" id="cat1_grades" placeholder="Grades (eg. 90,95,80)" onkeypress="return inputLimiter(event, 'Numbers')"/>
        <input type="submit" value="Update Category" onclick="populate_cat1(); add_cat1();" />
        <br/><br>
        <input type="radio" name="choice"/>&nbsp&nbsp&nbsp
        <input type="text" id="cat2_name" placeholder="Category"/>
        <input type="text" id="cat2_weight" placeholder="Weight" onkeypress="return inputLimiter(event, 'Numbers')"/>
        <input type="text" id="cat2_grades" placeholder="Grades" onkeypress="return inputLimiter(event, 'Numbers')"/>
        <input type="submit" value="Update Category" onclick="populate_cat2(); add_cat2();" />
        <br/><br>
        <input type="radio" name="choice"/>&nbsp&nbsp&nbsp
        <input type="text" id="cat3_name" placeholder="Category"/>
        <input type="text" id="cat3_weight" placeholder="Weight" onkeypress="return inputLimiter(event, 'Numbers')"/>
        <input type="text" id="cat3_grades" placeholder="Grades" onkeypress="return inputLimiter(event, 'Numbers')"/>
        <input type="submit" value="Update Category" onclick="populate_cat3(); add_cat3();" />
        <br/><br>
        <input type="radio" name="choice"/>&nbsp&nbsp&nbsp
        <input type="text" id="cat4_name" placeholder="Category"/>
        <input type="text" id="cat4_weight" placeholder="Weight" onkeypress="return inputLimiter(event, 'Numbers')"/>
        <input type="text" id="cat4_grades" placeholder="Grades" onkeypress="return inputLimiter(event, 'Numbers')"/>
        <input type="submit" value="Update Category" onclick="populate_cat4(); add_cat4();" />
        <br/><br>
        <input type="radio" name="choice"/>&nbsp&nbsp&nbsp
        <input type="text" id="cat5_name" placeholder="Category"/>
        <input type="text" id="cat5_weight" placeholder="Weight" onkeypress="return inputLimiter(event, 'Numbers')"/>
        <input type="text" id="cat5_grades" placeholder="Grades" onkeypress="return inputLimiter(event, 'Numbers')"/>
        <input type="submit" value="Update Category" onclick="populate_cat5(); add_cat5();" />
        <br/><br>
        <input type="radio" name="choice"/>&nbsp&nbsp&nbsp
        <input type="text" id="cat6_name" placeholder="Category"/>
        <input type="text" id="cat6_weight" placeholder="Weight" onkeypress="return inputLimiter(event, 'Numbers')"/>
        <input type="text" id="cat6_grades" placeholder="Grades" onkeypress="return inputLimiter(event, 'Numbers')"/>
        <input type="submit" value="Update Category" onclick="populate_cat6(); add_cat6();" />
    </form>
    <br/>
    
    <div id="averages">
        <p id="echo1"></p>
        <p id="echo2"></p>
        <p id="echo3"></p>
        <p id="echo4"></p>
        <p id="echo5"></p>
        <p id="echo6"></p>
    </div>

    <!--______________________________________________________________________________________-->
    <br/>
    <form id="form" onsubmit="return false;">
        <input type="submit" value="Calculate Current Class Average" onclick="calculate_class_average(); verify_weights();" />
    </form>
    <br/>
    <div class="well">
        <p id="average"></p>
    </div>
    <!--______________________________________________________________________________________-->
    <br/>
    <br/>

    <form onsubmit="return false;">
        <input type="submit" value="What grade do I need?" onclick="user_choice(); grades_missing(); final_answer();" />
    </form>
    <br>
    <div class="well">
        <p id="output"></p>
    </div>
    <br>
    <form onsubmit="return false;">
        <input type='reset' class="btn" value='RESET FORM' onclick="resetForm();" style='background-color: #FF3A3A;'>
    </form>
    <br><br><br>
    
    <script>
        // Average calculator, takes an array of numbers as an input
        function calculate_average(list_of_grades) {
            var total = 0;
            for (i=0; i < list_of_grades.length; i++) {
                total = total + list_of_grades[i];
            };
            var average = total / list_of_grades.length;
            return average;
        };
        
        var name_dict = {};
        var weight_dict = {};
        var grade_dict = {};
        var avg_dict = {}; 

        function inputLimiter(e,allow) {
            var AllowableCharacters = '';

            if (allow == 'Numbers'){AllowableCharacters='1234567890,.';}

            var k = document.all?parseInt(e.keyCode): parseInt(e.which);
            if (k!=13 && k!=8 && k!=0) {
                if ((e.ctrlKey==false) && (e.altKey==false)) {
                return (AllowableCharacters.indexOf(String.fromCharCode(k))!=-1);
                } else {
                return true;
                };
            } else {
                return true;
            };
        }; 

        function populate_cat1() {
            cat1_name = document.getElementById("cat1_name").value;
            cat1_weight = document.getElementById("cat1_weight").value;
            cat1_weight = Number(cat1_weight)
            cat1_grades = document.getElementById("cat1_grades").value;
            if (cat1_grades == "") {
                cat1 = {
                    name : cat1_name,
                    weight : cat1_weight,
                    grades : 'null'
                };
            } else {
                // convert grades to array of numbers
                cat1_grades = cat1_grades.split(',').map(Number);
                cat1 = {
                    name : cat1_name,
                    weight : cat1_weight,
                    grades : cat1_grades
                };
            };
            
        };
        function add_cat1() {
            name_dict['cat1'] = cat1.name;
            weight_dict['cat1'] = cat1.weight;
            grade_dict['cat1'] = cat1.grades;
            if (cat1.grades != 'null') {    
                avg_dict['cat1'] = calculate_average(cat1.grades);
                document.getElementById("echo1").innerHTML = name_dict.cat1 + " average is " + avg_dict.cat1 + "%";
            } else {
                avg_dict['cat1'] = 'null';
                document.getElementById('echo1').innerHTML = name_dict.cat1 + " average is not available";
                
            };
        };

        function populate_cat2() {
            cat2_name = document.getElementById("cat2_name").value;
            cat2_weight = document.getElementById("cat2_weight").value;
            cat2_weight = Number(cat2_weight);
            cat2_grades = document.getElementById("cat2_grades").value;
            
            if (cat2_grades == "") {
                cat2 = {
                    name : cat2_name,
                    weight : cat2_weight,
                    grades : 'null'
                };
            } else {
                cat2_grades = cat2_grades.split(',').map(Number);
                cat2 = {
                    name : cat2_name,
                    weight : cat2_weight,
                    grades : cat2_grades
                };
            };
        };
        
        function add_cat2() {
            name_dict['cat2'] = cat2.name;
            weight_dict['cat2'] = cat2.weight;
            grade_dict['cat2'] = cat2.grades;
            if (cat2.grades != 'null') {
                avg_dict['cat2'] = calculate_average(cat2.grades);
                document.getElementById('echo2').innerHTML = name_dict.cat2 + " average is " + avg_dict.cat2 + "%";
            } else {
                avg_dict['cat2'] = 'null';
                document.getElementById('echo2').innerHTML = name_dict.cat2 + " average is not available";
            };
        };

        function populate_cat3() {
            cat3_name = document.getElementById("cat3_name").value;
            cat3_weight = document.getElementById("cat3_weight").value;
            cat3_weight = Number(cat3_weight);
            cat3_grades = document.getElementById("cat3_grades").value;
            
            if (cat3_grades == "") {
                cat3 = {
                    name : cat3_name,
                    weight : cat3_weight,
                    grades : 'null'
                };
            } else {
                // convert grades to array of numbers
                cat3_grades = cat3_grades.split(',').map(Number);
                cat3 = {
                    name : cat3_name,
                    weight : cat3_weight,
                    grades : cat3_grades
                };
            };
        };
        
        function add_cat3() {
            name_dict['cat3'] = cat3.name;
            weight_dict['cat3'] = cat3.weight;
            grade_dict['cat3'] = cat3.grades;
            if (cat3.grades != 'null') {    
                avg_dict['cat3'] = calculate_average(cat3.grades);
                document.getElementById("echo3").innerHTML = name_dict.cat3 + " average is " + avg_dict.cat3 + "%";
            } else {
                avg_dict['cat3'] = 'null';
                document.getElementById('echo3').innerHTML = name_dict.cat3 + " average is not available";
            };
        };

        function populate_cat4() {
            cat4_name = document.getElementById("cat4_name").value;
            cat4_weight = document.getElementById("cat4_weight").value;
            cat4_weight = Number(cat4_weight);
            cat4_grades = document.getElementById("cat4_grades").value;
            
            if (cat4_grades == "") {
                cat4 = {
                    name : cat4_name,
                    weight : cat4_weight,
                    grades : 'null'
                };
            } else {
                // convert grades to array of numbers
                cat4_grades = cat4_grades.split(',').map(Number);
                cat4 = {
                    name : cat4_name,
                    weight : cat4_weight,
                    grades : cat4_grades
                };
            };
            
        };
        
        function add_cat4() {
            name_dict['cat4'] = cat4.name;
            weight_dict['cat4'] = cat4.weight;
            grade_dict['cat4'] = cat4.grades;
            if (cat4.grades != 'null') {    
                avg_dict['cat4'] = calculate_average(cat4.grades);
                document.getElementById("echo4").innerHTML = name_dict.cat4 + " average is " + avg_dict.cat4 + "%";
            } else {
                avg_dict['cat4'] = 'null';
                document.getElementById('echo4').innerHTML = name_dict.cat4 + " average is not available";
            };
        };

        function populate_cat5() {
            cat5_name = document.getElementById("cat5_name").value;
            cat5_weight = document.getElementById("cat5_weight").value;
            cat5_weight = Number(cat5_weight);
            cat5_grades = document.getElementById("cat5_grades").value;
            
            if (cat5_grades == "") {
                cat5 = {
                    name : cat5_name,
                    weight : cat5_weight,
                    grades : 'null'
                };
            } else {
                // convert grades to array of numbers
                cat5_grades = cat5_grades.split(',').map(Number);
                cat5 = {
                    name : cat5_name,
                    weight : cat5_weight,
                    grades : cat5_grades
                };
            };
        };
        
        function add_cat5() {
            name_dict['cat5'] = cat5.name;
            weight_dict['cat5'] = cat5.weight;
            grade_dict['cat5'] = cat5.grades;
            if (cat5.grades != 'null') {    
                avg_dict['cat5'] = calculate_average(cat5.grades);
                document.getElementById("echo5").innerHTML = name_dict.cat5 + " average is " + avg_dict.cat5 + "%";
            } else {
                avg_dict['cat5'] = 'null';
                document.getElementById('echo5').innerHTML = name_dict.cat5 + " average is not available";
            };
        };

        function populate_cat6() {
            cat6_name = document.getElementById("cat6_name").value;
            cat6_weight = document.getElementById("cat6_weight").value;
            cat6_weight = Number(cat6_weight)
            cat6_grades = document.getElementById("cat6_grades").value;
            if (cat6_grades == "") {
                cat6 = {
                    name : cat6_name,
                    weight : cat6_weight,
                    grades : 'null'
                };
            } else {
                // convert grades to array of numbers
                cat6_grades = cat6_grades.split(',').map(Number);
                cat6 = {
                    name : cat6_name,
                    weight : cat6_weight,
                    grades : cat6_grades
                };
            };
            
        };
        function add_cat6() {
            name_dict['cat6'] = cat6.name;
            weight_dict['cat6'] = cat6.weight;
            grade_dict['cat6'] = cat6.grades;
            if (cat6.grades != 'null') {    
                avg_dict['cat6'] = calculate_average(cat6.grades);
                document.getElementById("echo6").innerHTML = name_dict.cat6 + " average is " + avg_dict.cat6 + "%";
            } else {
                avg_dict['cat6'] = 'null';
                document.getElementById('echo6').innerHTML = name_dict.cat6 + " average is not available";
                
            };
        };

        // Verify that weights add up to 100%
        function verify_weights() {
            verify = true;
            var total2 = 0
            for (var key in weight_dict) {
                total2 = total2 + Number(weight_dict[key])
            };
            if (total2 != 100) {
                verify = false;
                alert('The weighting does not add up to 100%. Please refresh the page and start over.')
            };
        };
        
        function calculate_class_average() {
            var used_weight = 0;
            for (var key in weight_dict) {
                if (grade_dict[key] != 'null') {
                    used_weight = Number(used_weight) + Number(weight_dict[key]);
                };
            };            
            class_average = 0;
            for (var key in avg_dict) {
                if (grade_dict[key] != 'null') {
                    partial = (weight_dict[key] / used_weight) * avg_dict[key];
                    class_average = class_average + partial;
                };
            };
            document.getElementById('average').innerHTML = "Class average: " + class_average + "%";
            return class_average;
        };
        
        function user_choice() {
            var radios = document.getElementsByName('choice');
            if (radios[0].checked) {cat_choice = 'cat1'}
            else if (radios[1].checked) {cat_choice = 'cat2'}
            else if (radios[2].checked) {cat_choice = 'cat3'}
            else if (radios[3].checked) {cat_choice = 'cat4'}
            else if (radios[4].checked) {cat_choice = 'cat5'}
            else if (radios[5].checked) {cat_choice = 'cat6'};
        };
        
        function grades_missing() {
            checker = true; 
            count = 0;
            for (var key in grade_dict) {
                if (grade_dict[key] == 'null') {
                    checker = false;  
                    count = count + 1;
                };
            };
        };

        function final_answer() {
            if (verify == true) {
                var target_grade = document.getElementById("target_grade").value;
                target_grade = Number(target_grade)
                if (checker == true) {
                    // formula if all categories have grades
                    var formula1 = ( target_grade - ( class_average - (avg_dict[cat_choice] * (weight_dict[cat_choice] / 100) ) ) );
                    var formula2 = ( ( grade_dict[cat_choice].length + 1 ) / ( weight_dict[cat_choice] / 100 ) );
                    var formula3 = (avg_dict[cat_choice] * grade_dict[cat_choice].length);
                    output =  formula1 * formula2 - formula3;
                } else {
                    // if there are grades missing from more than one category
                    var final_used_weight = weight_dict[cat_choice];
                    for (key in grade_dict) {
                        if (grade_dict[key] != 'null') {
                            final_used_weight = final_used_weight + weight_dict[key];
                        };
                    };

                    var partial = 0;
                    for (key in avg_dict) {
                        if (grade_dict[key] != 'null') {
                            partial = partial + (avg_dict[key] * (weight_dict[key] / final_used_weight));
                        };
                    };

                    output = ( target_grade - partial ) / ( weight_dict[cat_choice] / final_used_weight );
                };
                document.getElementById('output').innerHTML = "You need a <b>" + (Math.round(output * 100 ) / 100) + "%</b> on your next <b>" + name_dict[cat_choice] + "</b> in order to bring your class average to <b>" + target_grade + "%</b>";
                return output
            } else {
                document.getElementById('output').innerHTML = "Error: Your category weights do not add up to 100%. Please correct them and update the category information."
            };
        };

        function resetForm() {
            $("form").trigger('reset');
            
            name_dict = {};
            weight_dict = {};
            grade_dict = {};
            avg_dict = {};
            
            $('#echo1').replaceWith("<p id='echo1'></p>");
            $('#echo2').replaceWith("<p id='echo2'></p>");
            $('#echo3').replaceWith("<p id='echo3'></p>");
            $('#echo4').replaceWith("<p id='echo4'></p>");
            $('#echo5').replaceWith("<p id='echo5'></p>");
            $('#echo6').replaceWith("<p id='echo6'></p>");

        };            
    </script>
</body>
</html>