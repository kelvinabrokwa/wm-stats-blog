<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap-theme.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="page-header">
            <h2>What Grade Do I Need?</h2>
            <p>Finals are almost here and there is one question on everyone's mind: What do I need on this final (or any other upcoming assignment) to get an A? Finally, here is the app to help you work that out!</p>
        </div>

        <!-- Button HTML (to Trigger Modal) -->
        <a href="#myModal" class="btn btn-lg btn-primary" data-toggle="modal">Disclaimer</a>

        <!-- Modal HTML -->
        <div id="myModal" class="modal fade">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title">Disclaimer</h4>
                    </div>
                    <div class="modal-body">
                        <p>The Crim Bell Curve and associates are not responsible for any final grade outcomes based on these calculations. The formulas used here work normally but all professors are free to structure grading systems as they choose. We are all peasants, just peasants.</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Got it!</button>
                    </div>
                </div>
            </div>
        </div>        
        
        <br/>
        <br/>
        <h4><u>Instructions</u></h4>
        <ul>
            <li>Input the name of a category (midterms, final, projects, etc.)</li>
            <li>Input category weights as percentages (out of 100) without the "%" sign</li>
            <li>Input all grades received in the third column separated by commas with no spaces, if you already know your category average, simply input that (if there have been no grades so far, leave blank)</li>
            <li>Select the category in which your upcoming assignment will be on the left of the form</li>
            <li>For each form used, click the "Add Category" button to the right</li>
        </ul>
        <br/>
        <h4><u>Step 1</u></h4>
        <form id="form" onsubmit="return false;">
            <input type="radio" name="choice" checked/>
            <input type="text" id="cat1_name" placeholder="Category (eg. quizzes)"/>
            <input type="text" id="cat1_weight" placeholder="Weight (eg. 30)"/>
            <input type="text" id="cat1_grades" placeholder="Grades (eg. 90,95,80)"/>
            <input type="submit" value="Add Category" onclick="populate_cat1(); add_cat1();" />
            <br/>
            <input type="radio" name="choice"/>
            <input type="text" id="cat2_name" placeholder="Category"/>
            <input type="text" id="cat2_weight" placeholder="Weight"/>
            <input type="text" id="cat2_grades" placeholder="Grades"/>
            <input type="submit" value="Add Category" onclick="populate_cat2(); add_cat2();" />
            <br/>
            <input type="radio" name="choice"/>
            <input type="text" id="cat3_name" placeholder="Category"/>
            <input type="text" id="cat3_weight" placeholder="Weight"/>
            <input type="text" id="cat3_grades" placeholder="Grades"/>
            <input type="submit" value="Add Category" onclick="populate_cat3(); add_cat3();" />
            <br/>
            <input type="radio" name="choice"/>
            <input type="text" id="cat4_name" placeholder="Category"/>
            <input type="text" id="cat4_weight" placeholder="Weight"/>
            <input type="text" id="cat4_grades" placeholder="Grades"/>
            <input type="submit" value="Add Category" onclick="populate_cat4(); add_cat4();" />
            <br/>
            <input type="radio" name="choice"/>
            <input type="text" id="cat5_name" placeholder="Category"/>
            <input type="text" id="cat5_weight" placeholder="Weight"/>
            <input type="text" id="cat5_grades" placeholder="Grades"/>
            <input type="submit" value="Add Category" onclick="populate_cat5(); add_cat5();" />
        </form>
        <br/>
        <p id="echo1"></p>
        <p id="echo2"></p>
        <p id="echo3"></p>
        <p id="echo4"></p>
        <p id="echo5"></p>

        <!------------------------------------------------------------------------------------------>
        <br/>
        <br/>
        <h4><u>Step 2</u></h4>
        <form id="form" onsubmit="return false;">
            <input type="submit" value="Calculate Current Class Average" onclick="calculate_class_average(); verify_weights();" />
        </form>
        <br/>
        <div class="well">
            <p id="average"></p>
        </div>
        <!------------------------------------------------------------------------------------------>
        <br/>
        <h4><u>Step 3</u></h4>
        <p>Enter target grade below as a percentage:</p>
        <form id="form" onsubmit="return false;">
            <input type="text" id="target_grade" placeholder="Target Grade"/>
            <input type="submit" value="What grade do I need???" onclick="user_choice(); grades_missing(); final_answer();" />
        </form>
        <br/>
        <div class="well">
            <p id="output"></p>
        </div>
    </div>
    <script>
        // Average calculator, takes an array of numbers as an input
        function calculate_average(list_of_grades) {
            var total = 0;
            for (i=0; i < list_of_grades.length; i++) {
                total = total + list_of_grades[i];
            };
            var average = total / list_of_grades.length;
            return average;
        };
        
        var name_dict = {};
        var weight_dict = {};
        var grade_dict = {};
        var avg_dict = {};
        
        function populate_cat1() {
            cat1_name = document.getElementById("cat1_name").value;
            cat1_weight = document.getElementById("cat1_weight").value;
            cat1_weight = Number(cat1_weight)
            cat1_grades = document.getElementById("cat1_grades").value;
            
            if (cat1_grades == "") {
                cat1 = {
                    name : cat1_name,
                    weight : cat1_weight,
                    grades : 'null'
                };
            } else {
                // convert grades to array of numbers
                cat1_grades = cat1_grades.split(',').map(Number);
                cat1 = {
                    name : cat1_name,
                    weight : cat1_weight,
                    grades : cat1_grades
                };
            };
            
        };
        
        function add_cat1() {
            name_dict['cat1'] = cat1.name;
            weight_dict['cat1'] = cat1.weight;
            grade_dict['cat1'] = cat1.grades
            if (cat1.grades != 'null') {    
                avg_dict['cat1'] = calculate_average(cat1.grades);
                document.getElementById("echo1").innerHTML = name_dict.cat1 + " average is " + avg_dict.cat1 + "%";
            } else {
                avg_dict['cat1'] = 'null';
                document.getElementById('echo1').innerHTML = name_dict.cat1 + " average is not available";
            };
            
        };
        
        function populate_cat2() {
            cat2_name = document.getElementById("cat2_name").value;
            cat2_weight = document.getElementById("cat2_weight").value;
            cat2_grades = document.getElementById("cat2_grades").value;
            // Convert grades input to list of numbers
            cat2_grades = cat2_grades.split(',').map(Number);
            cat2 = {
                name : cat2_name,
                weight : cat2_weight,
                grades : cat2_grades
            };
        };
        function add_cat2() {
            name_dict['cat2'] = cat2.name;
            weight_dict['cat2'] = cat2.weight;
            grade_dict['cat2'] = cat2.grades;
            avg_dict['cat2'] = calculate_average(cat2.grades);
            document.getElementById("echo2").innerHTML = name_dict.cat2 + " average is " + avg_dict.cat2 + "%";
        };
        
        function populate_cat3() {
            cat3_name = document.getElementById("cat3_name").value;
            cat3_weight = document.getElementById("cat3_weight").value;
            cat3_grades = document.getElementById("cat3_grades").value;
            // Convert grades input to list of numbers
            cat3_grades = cat3_grades.split(',').map(Number);
            cat3 = {
                name : cat3_name,
                weight : cat3_weight,
                grades : cat3_grades
            };
        };
        function add_cat3() {
            name_dict['cat3'] = cat3.name;
            weight_dict['cat3'] = cat3.weight;
            grade_dict['cat3'] = cat3.grades;
            avg_dict['cat3'] = calculate_average(cat3.grades);
            document.getElementById("echo3").innerHTML = name_dict.cat3 + " average is " + avg_dict.cat3 + "%";
        };        
        
        function populate_cat4() {
            cat4_name = document.getElementById("cat4_name").value;
            cat4_weight = document.getElementById("cat4_weight").value;
            cat4_grades = document.getElementById("cat4_grades").value;
            // Convert grades input to list of numbers
            cat4_grades = cat4_grades.split(',').map(Number);
            cat4 = {
                name : cat4_name,
                weight : cat4_weight,
                grades : cat4_grades
            };
        };
        function add_cat4() {
            name_dict['cat4'] = cat4.name;
            weight_dict['cat4'] = cat4.weight;
            grade_dict['cat4'] = cat4.grades;
            avg_dict['cat4'] = calculate_average(cat4.grades);
            document.getElementById("echo4").innerHTML = name_dict.cat4 + " average is " + avg_dict.cat4 + "%";
        };  
        
        function populate_cat5() {
            cat5_name = document.getElementById("cat5_name").value;
            cat5_weight = document.getElementById("cat5_weight").value;
            cat5_grades = document.getElementById("cat5_grades").value;
            // Convert grades input to list of numbers
            cat5_grades = cat5_grades.split(',').map(Number);
            cat5 = {
                name : cat5_name,
                weight : cat5_weight,
                grades : cat5_grades
            };
        };
        function add_cat5() {
            name_dict['cat5'] = cat5.name;
            weight_dict['cat5'] = cat5.weight;
            grade_dict['cat5'] = cat5.grades;
            avg_dict['cat5'] = calculate_average(cat5.grades);
            document.getElementById("echo5").innerHTML = name_dict.cat5 + " average is " + avg_dict.cat5 + "%";
        }; 
        
        // Verify that weights add up to 100%
        function verify_weights() {
            var total2 = 0
            for (var key in weight_dict) {
                total2 = total2 + Number(weight_dict[key])
            };
            if (total2 != 100) {
                alert('The weighting does not add up to 100%. Please refresh the page and start over.')
            };
        };
        
        function calculate_class_average() {
            var used_weight = 0;
            for (var key in weight_dict) {
                if (grade_dict[key] != 'null') {
                    used_weight = Number(used_weight) + Number(weight_dict[key]);
                };
            };            
            class_average = 0;
            for (var key in avg_dict) {
                if (grade_dict[key] != 'null') {
                    partial = (weight_dict[key] / used_weight) * avg_dict[key];
                    class_average = class_average + partial;
                };
            };
            document.getElementById('average').innerHTML = "Class average: " + class_average + "%";
            return class_average;
        };
        
        function user_choice() {
            var radios = document.getElementsByName('choice');
            if (radios[0].checked) {cat_choice = 'cat1'}
            else if (radios[1].checked) {cat_choice = 'cat2'}
            else if (radios[2].checked) {cat_choice = 'cat3'}
            else if (radios[3].checked) {cat_choice = 'cat4'}
            else if (radios[4].checked) {cat_choice = 'cat5'};
        };
        
        function grades_missing() {
            checker = true; 
            for (var key in grade_dict) {
                if (grade_dict[key] == 'null') {
                    checker = false;  
                };
            };
        };
        
        function final_answer() {
            var target_grade = document.getElementById("target_grade").value;
            target_grade = Number(target_grade)
            if (checker == true) {
                // var class_avg = calculate_class_average();
                // The formula, broken up to look cleaner
                var formula1 = ( target_grade - ( class_average - (avg_dict[cat_choice] * (weight_dict[cat_choice] / 100) ) ) );
                var formula2 = ( ( grade_dict[cat_choice].length + 1 ) / ( weight_dict[cat_choice] / 100 ) );
                var formula3 = (avg_dict[cat_choice] * grade_dict[cat_choice].length);
                output =  formula1 * formula2 - formula3;
            } else if (grade_dict[cat_choice] == 'null') {
                var partial = 0;
                for (key in avg_dict) {
                    if (grade_dict[key] != 'null') {
                        partial = partial + (avg_dict[key] * (weight_dict[key] / 100))
                    };
                };
                output = ( target_grade - partial ) / (weight_dict[cat_choice] / 100)
            };
            document.getElementById('output').innerHTML = "You need a " + output + "% on your next " + name_dict[cat_choice] + " in order to bring your class average to " + target_grade + "%";
            return output
        };
            
    </script>
</body>
</html>







